<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PixiJS Rectangles</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
            background: white;
        }
    </style>
</head>

<body>
    <script>
        // Create some fake event data
        let data = [
            { start: 1, end: 10, name: "Event 1", process: 0 },
            { start: 3, end: 4, name: "Event 2 asdfasdfasdfasdfasdfasdfasdfasdfasdfasdfasdfasdfasdfasdfasdfasdf", process: 1, },
            { start: 7, end: 9, name: "Event 3", process: 2, },
            { start: 8, end: 12, name: "Event 4", process: 0, },
            { start: 10, end: 15, name: "Event 5", process: 1, },
            { start: 13, end: 17, name: "Event 6", process: 2, },
        ]
        const processes = data
            .map(d => d.process)
            .filter((value, index, self) => self.indexOf(value) === index)
            .sort();

        // Create a Pixi Application
        const margin = { top: 20, right: 50, bottom: 50, left: 70 }; // Adjust margins as needed
        const appWidth = window.innerWidth - margin.left - margin.right;
        const appHeight = 70 + 25 * processes.length;

        let app = new PIXI.Application({
            resizeTo: window,
            antialias: true,
            backgroundColor: 0xFFFFFF,
            resolution: 1
        });

        // Add the canvas that Pixi automatically created for you to the HTML document
        document.body.appendChild(app.view);

        const xScale = d3.scaleLinear()
            .domain([0, d3.max(data, d => d.end)])
            .range([margin.left, appWidth - margin.right]);

        const yScale = d3
            .scaleBand()
            .domain(processes)
            .range([margin.top, appHeight - margin.bottom]);
        
        // Color by event name
        const colorScale = d3
            .scaleOrdinal(d3.schemeCategory10)
            .domain(data.map(d => d.name));

        const font = PIXI.BitmapFont.from('LabelFont', {
            fontFamily: 'Arial',
            fontSize: 12,
            strokeThickness: 0,
            fill: 'white',
        });

        data.forEach((event, i) => {
            // Add the rectangle
            const graphics = new PIXI.Graphics();
            const color = colorScale(event.name);
            graphics.beginFill(parseInt(color.replace(/^#/, ''), 16));
            graphics.drawRect(
                xScale(event.start),
                yScale(event.process),
                xScale(event.end - event.start),
                yScale.bandwidth()
            );
            graphics.endFill();
            app.stage.addChild(graphics);

            // Add the label
            const text = new PIXI.BitmapText(event.name, {
                fontName: 'LabelFont',
                fontSize: 12,
                align: 'left',
            });
            text.x = xScale(event.start) + 5;
            text.y = yScale(event.process);
            text.anchor = new PIXI.Point(0, -0.5);
            app.stage.addChild(text);

            // Create a clipping mask for the label
            const mask = new PIXI.Graphics();
            mask.beginFill(0x000000);
            mask.drawRect(
                xScale(event.start),
                yScale(event.process),
                xScale(event.end - event.start),
                yScale.bandwidth()
            );
            mask.endFill();
            text.mask = mask;
        });
    </script>
</body>

</html>